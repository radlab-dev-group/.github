<section class="tech-section" id="request-flow"
         style="background: radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.08), transparent 60%), #020617; padding: 4rem 0; color: #e2e8f0; font-family: system-ui, -apple-system, sans-serif;">
    <div class="flow-container">
        <div class="section-header">
            <h2 class="section-title">Request Flow</h2>
            <p class="section-subtitle">Lifecycle of a request from ingress to response</p>
        </div>

        <div class="flow-grid">

            <!-- KOLUMNA 1: Ingress & Security -->
            <div class="flow-column">
                <div class="column-header">
                    <span>Phase 1</span> Input & Security
                    <span class="flow-arrow">→</span>
                </div>

                <div class="flow-card">
                    <div class="step-num">1</div>
                    <span class="card-title">Request Ingress</span>
                    <span class="card-desc">Flask receives HTTP request at registered endpoint.</span>
                </div>

                <div class="flow-card">
                    <div class="step-num">2</div>
                    <span class="card-title">Parameter Extraction</span>
                    <span class="card-desc"><code>FlaskEndpointRegistrar</code> extracts JSON/form params.</span>
                </div>

                <div class="flow-card card-optional">
                    <div class="step-num">3</div>
                    <span class="card-title">Guardrail Validation <small>(Optional)</small></span>
                    <span class="card-desc"><code>GuardrailPipeline</code> checks content safety via plugins.</span>
                </div>

                <div class="flow-card card-optional">
                    <div class="step-num">4</div>
                    <span class="card-title">Data Masking <small>(Optional)</small></span>
                    <span class="card-desc"><code>MaskerPipeline</code> anonymizes sensitive data (PII).</span>
                </div>
            </div>

            <!-- KOLUMNA 2: Logic & Routing -->
            <div class="flow-column">
                <div class="column-header">
                    <span>Phase 2</span> Routing & Logic
                    <span class="flow-arrow">→</span>
                </div>

                <div class="flow-card">
                    <div class="step-num">5</div>
                    <span class="card-title">Endpoint Dispatch</span>
                    <span class="card-desc"><code>run_ep()</code> called on concrete Endpoint implementation.</span>
                </div>

                <div class="flow-card">
                    <div class="step-num">6</div>
                    <span class="card-title">Payload Preparation</span>
                    <span class="card-desc"><code>prepare_payload()</code> normalizes params & validates args.</span>
                </div>

                <div class="flow-card">
                    <div class="step-num">7</div>
                    <span class="card-title">Model Resolution</span>
                    <span class="card-desc"><code>get_model_provider()</code> resolves model name via Handler.</span>
                </div>

                <div class="flow-card">
                    <div class="step-num">8</div>
                    <span class="card-title">Provider Selection</span>
                    <span class="card-desc"><code>ProviderChooser</code> picks provider using strategy.</span>
                </div>

                <div class="flow-card card-optional">
                    <div class="step-num">9</div>
                    <span class="card-title">Prompt Injection <small>(Optional)</small></span>
                    <span class="card-desc">System prompt injected from <code>PromptHandler</code>.</span>
                </div>
            </div>

            <!-- KOLUMNA 3: Execution -->
            <div class="flow-column">
                <div class="column-header">
                    <span>Phase 3</span> Execution & Output
                </div>

                <div class="flow-card card-execute">
                    <div class="step-num">10</div>
                    <span class="card-title">HTTP Execution</span>
                    <span class="card-desc"><code>HttpRequestExecutor</code> sends request to external LLM API.</span>
                </div>

                <div class="flow-card card-retry">
                    <div class="step-num">12</div>
                    <span class="card-title">Retry Logic <small>(If failed)</small></span>
                    <span class="card-desc">Auto retry with backoff up to <code>MAX_RECONNECTIONS</code>.</span>
                </div>

                <div class="flow-card card-execute">
                    <div class="step-num">11</div>
                    <span class="card-title">Response Handling</span>
                    <span class="card-desc">Response parsed, optionally streamed via SSE.</span>
                </div>
            </div>

        </div>
    </div>
</section>

