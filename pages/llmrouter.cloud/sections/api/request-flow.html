<section class="tech-section" id="request-flow"
         style="background: radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.08), transparent 60%), #020617; padding: 3rem 0;">
    <div class="container">
        <h2 class="section-title">Request Flow</h2>
        <p class="section-subtitle">How a request travels through the system</p>

        <div class="flow-diagram">
            <div class="flow-step">
                <strong>1. Request Ingress</strong> – Flask receives HTTP request at registered endpoint
            </div>
            <div class="flow-step">
                <strong>2. Parameter Extraction</strong> – <code>FlaskEndpointRegistrar</code> extracts JSON/form params
            </div>
            <div class="flow-step">
                <strong>3. Guardrail Validation</strong> – (optional) <code>GuardrailPipeline</code> validates content safety through sequential plugins (e.g., NASK Guard)
            </div>
            <div class="flow-step">
                <strong>4. Data Masking</strong> – (optional) <code>MaskerPipeline</code> anonymizes sensitive data through sequential plugins (e.g., fast_masker)
            </div>
            <div class="flow-step">
                <strong>5. Endpoint Dispatch</strong> – <code>run_ep()</code> called on concrete EndpointI subclass
            </div>
            <div class="flow-step">
                <strong>6. Payload Preparation</strong> – <code>prepare_payload()</code> normalizes params, validates
                required args
            </div>
            <div class="flow-step">
                <strong>7. Model Resolution</strong> – <code>get_model_provider()</code> resolves model name via
                ModelHandler
            </div>
            <div class="flow-step">
                <strong>8. Provider Selection</strong> – <code>ProviderChooser</code> picks provider using configured
                strategy
            </div>
            <div class="flow-step">
                <strong>9. Prompt Injection</strong> – (optional) System prompt injected from <code>PromptHandler</code>
            </div>
            <div class="flow-step">
                <strong>10. HTTP Execution</strong> – <code>HttpRequestExecutor</code> sends request to external LLM API
            </div>
            <div class="flow-step">
                <strong>11. Response Handling</strong> – Response parsed, optionally streamed via SSE
            </div>
            <div class="flow-step">
                <strong>12. Retry Logic</strong> – (on failure) Automatic retry with backoff, up to <code>MAX_RECONNECTIONS</code>
            </div>
        </div>
    </div>
</section>